{"ast":null,"code":"// src/firebase/uploadManager.js\nimport { ref, uploadBytesResumable, uploadBytes, getDownloadURL } from \"firebase/storage\";\nimport { storage } from \"./config.js\";\n\n// ------------------------------------------\n// 1) Chat attachments with progress\n// ------------------------------------------\nexport async function uploadChatAttachmentsWithProgress(threadId, files, onProgress) {\n  if (!threadId || !files || files.length === 0) return [];\n  const uploads = files.map((file, index) => new Promise((resolve, reject) => {\n    const safeName = file.name.replace(/\\s+/g, \"_\");\n    const path = `chatAttachments/${threadId}/${Date.now()}_${safeName}`;\n    const fileRef = ref(storage, path);\n    const task = uploadBytesResumable(fileRef, file);\n\n    // Progress tracking\n    task.on(\"state_changed\", snapshot => {\n      const percent = Math.round(snapshot.bytesTransferred / snapshot.totalBytes * 100);\n      if (typeof onProgress === \"function\") {\n        onProgress(index, percent);\n      }\n    }, reject, async () => {\n      const url = await getDownloadURL(task.snapshot.ref);\n      resolve({\n        url,\n        name: file.name,\n        contentType: file.type,\n        size: file.size\n      });\n    });\n  }));\n  return Promise.all(uploads);\n}\n\n// ------------------------------------------\n// 2) Listing images (CreateListing)\n//    Signature: uploadListingImages(files: File[]) => Promise<string[]>\n// ------------------------------------------\nexport async function uploadListingImages(files) {\n  if (!files || files.length === 0) return [];\n  const uploads = files.map(file => new Promise((resolve, reject) => {\n    const safeName = file.name.replace(/\\s+/g, \"_\");\n    const path = `listingImages/${Date.now()}_${safeName}`;\n    const fileRef = ref(storage, path);\n    const task = uploadBytesResumable(fileRef, file);\n    task.on(\"state_changed\", () => {\n      // We don't surface per-image progress here for listings,\n      // but this is where you'd do it if you wanted.\n    }, reject, async () => {\n      const url = await getDownloadURL(task.snapshot.ref);\n      resolve(url);\n    });\n  }));\n  return Promise.all(uploads);\n}\n\n// ------------------------------------------\n// 3) Avatar upload (Profile)\n//    Signature: uploadAvatar(file: File) => Promise<string>\n// ------------------------------------------\nexport async function uploadAvatar(file) {\n  if (!file) return \"\";\n  const safeName = file.name.replace(/\\s+/g, \"_\");\n  const path = `avatars/${Date.now()}_${safeName}`;\n  const fileRef = ref(storage, path);\n\n  // Avatar is usually single & small, simple upload is fine\n  const snapshot = await uploadBytes(fileRef, file);\n  const url = await getDownloadURL(snapshot.ref);\n  return url;\n}","map":{"version":3,"names":["ref","uploadBytesResumable","uploadBytes","getDownloadURL","storage","uploadChatAttachmentsWithProgress","threadId","files","onProgress","length","uploads","map","file","index","Promise","resolve","reject","safeName","name","replace","path","Date","now","fileRef","task","on","snapshot","percent","Math","round","bytesTransferred","totalBytes","url","contentType","type","size","all","uploadListingImages","uploadAvatar"],"sources":["C:/Users/Floyd/Desktop/Websites/HIAWTO/hi-awto-clean/src/firebase/uploadManager.js"],"sourcesContent":["// src/firebase/uploadManager.js\r\nimport { ref, uploadBytesResumable, uploadBytes, getDownloadURL } from \"firebase/storage\";\r\nimport { storage } from \"./config.js\";\r\n\r\n// ------------------------------------------\r\n// 1) Chat attachments with progress\r\n// ------------------------------------------\r\nexport async function uploadChatAttachmentsWithProgress(threadId, files, onProgress) {\r\n  if (!threadId || !files || files.length === 0) return [];\r\n\r\n  const uploads = files.map(\r\n    (file, index) =>\r\n      new Promise((resolve, reject) => {\r\n        const safeName = file.name.replace(/\\s+/g, \"_\");\r\n        const path = `chatAttachments/${threadId}/${Date.now()}_${safeName}`;\r\n        const fileRef = ref(storage, path);\r\n\r\n        const task = uploadBytesResumable(fileRef, file);\r\n\r\n        // Progress tracking\r\n        task.on(\r\n          \"state_changed\",\r\n          (snapshot) => {\r\n            const percent = Math.round(\r\n              (snapshot.bytesTransferred / snapshot.totalBytes) * 100\r\n            );\r\n\r\n            if (typeof onProgress === \"function\") {\r\n              onProgress(index, percent);\r\n            }\r\n          },\r\n          reject,\r\n          async () => {\r\n            const url = await getDownloadURL(task.snapshot.ref);\r\n            resolve({\r\n              url,\r\n              name: file.name,\r\n              contentType: file.type,\r\n              size: file.size,\r\n            });\r\n          }\r\n        );\r\n      })\r\n  );\r\n\r\n  return Promise.all(uploads);\r\n}\r\n\r\n// ------------------------------------------\r\n// 2) Listing images (CreateListing)\r\n//    Signature: uploadListingImages(files: File[]) => Promise<string[]>\r\n// ------------------------------------------\r\nexport async function uploadListingImages(files) {\r\n  if (!files || files.length === 0) return [];\r\n\r\n  const uploads = files.map(\r\n    (file) =>\r\n      new Promise((resolve, reject) => {\r\n        const safeName = file.name.replace(/\\s+/g, \"_\");\r\n        const path = `listingImages/${Date.now()}_${safeName}`;\r\n        const fileRef = ref(storage, path);\r\n\r\n        const task = uploadBytesResumable(fileRef, file);\r\n\r\n        task.on(\r\n          \"state_changed\",\r\n          () => {\r\n            // We don't surface per-image progress here for listings,\r\n            // but this is where you'd do it if you wanted.\r\n          },\r\n          reject,\r\n          async () => {\r\n            const url = await getDownloadURL(task.snapshot.ref);\r\n            resolve(url);\r\n          }\r\n        );\r\n      })\r\n  );\r\n\r\n  return Promise.all(uploads);\r\n}\r\n\r\n// ------------------------------------------\r\n// 3) Avatar upload (Profile)\r\n//    Signature: uploadAvatar(file: File) => Promise<string>\r\n// ------------------------------------------\r\nexport async function uploadAvatar(file) {\r\n  if (!file) return \"\";\r\n\r\n  const safeName = file.name.replace(/\\s+/g, \"_\");\r\n  const path = `avatars/${Date.now()}_${safeName}`;\r\n  const fileRef = ref(storage, path);\r\n\r\n  // Avatar is usually single & small, simple upload is fine\r\n  const snapshot = await uploadBytes(fileRef, file);\r\n  const url = await getDownloadURL(snapshot.ref);\r\n  return url;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}