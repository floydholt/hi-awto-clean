{"ast":null,"code":"// src/firebase/listings.js\nimport { collection, addDoc, doc, getDoc, getDocs, updateDoc, deleteDoc, serverTimestamp, query, where, orderBy } from \"firebase/firestore\";\nimport { getFirestore } from \"firebase/firestore\";\nimport { getApp } from \"firebase/app\";\nconst db = getFirestore(getApp());\nconst LISTINGS_COL = \"listings\";\n\n// Create a new listing (user-facing form)\nexport async function createListing(data) {\n  const now = serverTimestamp();\n  const payload = {\n    title: data.title || \"\",\n    address: data.address || \"\",\n    price: typeof data.price === \"number\" ? data.price : Number(data.price) || 0,\n    downPayment: typeof data.downPayment === \"number\" ? data.downPayment : Number(data.downPayment) || 0,\n    description: data.description || \"\",\n    featured: !!data.featured,\n    imageUrls: Array.isArray(data.imageUrls) ? data.imageUrls : [],\n    // status / moderation\n    status: \"pending\",\n    // \"pending\" | \"approved\" | \"rejected\"\n    approved: false,\n    createdAt: now,\n    updatedAt: now,\n    // AI fields (populated by Cloud Functions)\n    aiTags: data.aiTags || [],\n    aiCaption: data.aiCaption || \"\",\n    aiFullDescription: data.aiFullDescription || \"\",\n    aiPricing: data.aiPricing || null,\n    aiFraudScore: typeof data.aiFraudScore === \"number\" ? data.aiFraudScore : null,\n    aiFraudReason: data.aiFraudReason || \"\"\n  };\n  const ref = await addDoc(collection(db, LISTINGS_COL), payload);\n  return ref.id;\n}\n\n// Update listing (generic)\nexport async function updateListing(id, data) {\n  const ref = doc(db, LISTINGS_COL, id);\n  await updateDoc(ref, {\n    ...data,\n    updatedAt: serverTimestamp()\n  });\n}\n\n// Delete listing\nexport async function deleteListing(id) {\n  const ref = doc(db, LISTINGS_COL, id);\n  await deleteDoc(ref);\n}\n\n// Get single listing\nexport async function getListingById(id) {\n  const ref = doc(db, LISTINGS_COL, id);\n  const snap = await getDoc(ref);\n  if (!snap.exists()) return null;\n  return {\n    id: snap.id,\n    ...snap.data()\n  };\n}\n\n// Public listings (only approved)\nexport async function getAllListings() {\n  const q = query(collection(db, LISTINGS_COL), where(\"approved\", \"==\", true), orderBy(\"createdAt\", \"desc\"));\n  const snap = await getDocs(q);\n  return snap.docs.map(d => ({\n    id: d.id,\n    ...d.data()\n  }));\n}\n\n// For /search page (same as above, but kept explicit)\nexport async function searchApprovedListings() {\n  return getAllListings();\n}\n\n// Current user's listings (for /my-listings)\nexport async function getMyListings(userId) {\n  if (!userId) return [];\n  const q = query(collection(db, LISTINGS_COL), where(\"ownerId\", \"==\", userId), orderBy(\"createdAt\", \"desc\"));\n  const snap = await getDocs(q);\n  return snap.docs.map(d => ({\n    id: d.id,\n    ...d.data()\n  }));\n}\n\n// -----------------------------\n// ADMIN HELPERS\n// -----------------------------\n\n// Get all listings for admin with optional status filter\nexport async function getAdminListings(statusFilter = \"all\") {\n  const colRef = collection(db, LISTINGS_COL);\n  let q;\n  if (statusFilter === \"all\") {\n    q = query(colRef, orderBy(\"createdAt\", \"desc\"));\n  } else {\n    q = query(colRef, where(\"status\", \"==\", statusFilter), orderBy(\"createdAt\", \"desc\"));\n  }\n  const snap = await getDocs(q);\n  return snap.docs.map(d => ({\n    id: d.id,\n    ...d.data()\n  }));\n}\n\n// Approve listing\nexport async function approveListing(id) {\n  const ref = doc(db, LISTINGS_COL, id);\n  await updateDoc(ref, {\n    approved: true,\n    status: \"approved\",\n    updatedAt: serverTimestamp()\n  });\n}\n\n// Reject listing\nexport async function rejectListing(id, reason = \"\") {\n  const ref = doc(db, LISTINGS_COL, id);\n  await updateDoc(ref, {\n    approved: false,\n    status: \"rejected\",\n    rejectionReason: reason,\n    updatedAt: serverTimestamp()\n  });\n}\n\n// Reset to pending\nexport async function resetListingToPending(id) {\n  const ref = doc(db, LISTINGS_COL, id);\n  await updateDoc(ref, {\n    approved: false,\n    status: \"pending\",\n    updatedAt: serverTimestamp()\n  });\n}\n\n// Toggle featured\nexport async function setListingFeatured(id, featured) {\n  const ref = doc(db, LISTINGS_COL, id);\n  await updateDoc(ref, {\n    featured: !!featured,\n    updatedAt: serverTimestamp()\n  });\n}","map":{"version":3,"names":["collection","addDoc","doc","getDoc","getDocs","updateDoc","deleteDoc","serverTimestamp","query","where","orderBy","getFirestore","getApp","db","LISTINGS_COL","createListing","data","now","payload","title","address","price","Number","downPayment","description","featured","imageUrls","Array","isArray","status","approved","createdAt","updatedAt","aiTags","aiCaption","aiFullDescription","aiPricing","aiFraudScore","aiFraudReason","ref","id","updateListing","deleteListing","getListingById","snap","exists","getAllListings","q","docs","map","d","searchApprovedListings","getMyListings","userId","getAdminListings","statusFilter","colRef","approveListing","rejectListing","reason","rejectionReason","resetListingToPending","setListingFeatured"],"sources":["C:/Users/Floyd/Desktop/Websites/HIAWTO/hi-awto-clean/src/firebase/listings.js"],"sourcesContent":["// src/firebase/listings.js\r\nimport {\r\n  collection,\r\n  addDoc,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  updateDoc,\r\n  deleteDoc,\r\n  serverTimestamp,\r\n  query,\r\n  where,\r\n  orderBy,\r\n} from \"firebase/firestore\";\r\nimport { getFirestore } from \"firebase/firestore\";\r\nimport { getApp } from \"firebase/app\";\r\n\r\nconst db = getFirestore(getApp());\r\n\r\n\r\nconst LISTINGS_COL = \"listings\";\r\n\r\n// Create a new listing (user-facing form)\r\nexport async function createListing(data) {\r\n  const now = serverTimestamp();\r\n\r\n  const payload = {\r\n    title: data.title || \"\",\r\n    address: data.address || \"\",\r\n    price: typeof data.price === \"number\" ? data.price : Number(data.price) || 0,\r\n    downPayment:\r\n      typeof data.downPayment === \"number\"\r\n        ? data.downPayment\r\n        : Number(data.downPayment) || 0,\r\n    description: data.description || \"\",\r\n    featured: !!data.featured,\r\n    imageUrls: Array.isArray(data.imageUrls) ? data.imageUrls : [],\r\n    // status / moderation\r\n    status: \"pending\", // \"pending\" | \"approved\" | \"rejected\"\r\n    approved: false,\r\n    createdAt: now,\r\n    updatedAt: now,\r\n\r\n    // AI fields (populated by Cloud Functions)\r\n    aiTags: data.aiTags || [],\r\n    aiCaption: data.aiCaption || \"\",\r\n    aiFullDescription: data.aiFullDescription || \"\",\r\n    aiPricing: data.aiPricing || null,\r\n    aiFraudScore:\r\n      typeof data.aiFraudScore === \"number\" ? data.aiFraudScore : null,\r\n    aiFraudReason: data.aiFraudReason || \"\",\r\n  };\r\n\r\n  const ref = await addDoc(collection(db, LISTINGS_COL), payload);\r\n  return ref.id;\r\n}\r\n\r\n// Update listing (generic)\r\nexport async function updateListing(id, data) {\r\n  const ref = doc(db, LISTINGS_COL, id);\r\n  await updateDoc(ref, {\r\n    ...data,\r\n    updatedAt: serverTimestamp(),\r\n  });\r\n}\r\n\r\n// Delete listing\r\nexport async function deleteListing(id) {\r\n  const ref = doc(db, LISTINGS_COL, id);\r\n  await deleteDoc(ref);\r\n}\r\n\r\n// Get single listing\r\nexport async function getListingById(id) {\r\n  const ref = doc(db, LISTINGS_COL, id);\r\n  const snap = await getDoc(ref);\r\n  if (!snap.exists()) return null;\r\n  return { id: snap.id, ...snap.data() };\r\n}\r\n\r\n// Public listings (only approved)\r\nexport async function getAllListings() {\r\n  const q = query(\r\n    collection(db, LISTINGS_COL),\r\n    where(\"approved\", \"==\", true),\r\n    orderBy(\"createdAt\", \"desc\")\r\n  );\r\n  const snap = await getDocs(q);\r\n  return snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n}\r\n\r\n// For /search page (same as above, but kept explicit)\r\nexport async function searchApprovedListings() {\r\n  return getAllListings();\r\n}\r\n\r\n// Current user's listings (for /my-listings)\r\nexport async function getMyListings(userId) {\r\n  if (!userId) return [];\r\n  const q = query(\r\n    collection(db, LISTINGS_COL),\r\n    where(\"ownerId\", \"==\", userId),\r\n    orderBy(\"createdAt\", \"desc\")\r\n  );\r\n  const snap = await getDocs(q);\r\n  return snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n}\r\n\r\n// -----------------------------\r\n// ADMIN HELPERS\r\n// -----------------------------\r\n\r\n// Get all listings for admin with optional status filter\r\nexport async function getAdminListings(statusFilter = \"all\") {\r\n  const colRef = collection(db, LISTINGS_COL);\r\n\r\n  let q;\r\n  if (statusFilter === \"all\") {\r\n    q = query(colRef, orderBy(\"createdAt\", \"desc\"));\r\n  } else {\r\n    q = query(\r\n      colRef,\r\n      where(\"status\", \"==\", statusFilter),\r\n      orderBy(\"createdAt\", \"desc\")\r\n    );\r\n  }\r\n\r\n  const snap = await getDocs(q);\r\n  return snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n}\r\n\r\n// Approve listing\r\nexport async function approveListing(id) {\r\n  const ref = doc(db, LISTINGS_COL, id);\r\n  await updateDoc(ref, {\r\n    approved: true,\r\n    status: \"approved\",\r\n    updatedAt: serverTimestamp(),\r\n  });\r\n}\r\n\r\n// Reject listing\r\nexport async function rejectListing(id, reason = \"\") {\r\n  const ref = doc(db, LISTINGS_COL, id);\r\n  await updateDoc(ref, {\r\n    approved: false,\r\n    status: \"rejected\",\r\n    rejectionReason: reason,\r\n    updatedAt: serverTimestamp(),\r\n  });\r\n}\r\n\r\n// Reset to pending\r\nexport async function resetListingToPending(id) {\r\n  const ref = doc(db, LISTINGS_COL, id);\r\n  await updateDoc(ref, {\r\n    approved: false,\r\n    status: \"pending\",\r\n    updatedAt: serverTimestamp(),\r\n  });\r\n}\r\n\r\n// Toggle featured\r\nexport async function setListingFeatured(id, featured) {\r\n  const ref = doc(db, LISTINGS_COL, id);\r\n  await updateDoc(ref, {\r\n    featured: !!featured,\r\n    updatedAt: serverTimestamp(),\r\n  });\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}