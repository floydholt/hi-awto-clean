{"ast":null,"code":"import _objectSpread from\"C:/Users/Floyd/Desktop/Websites/HIAWTO/hi-awto-clean/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{collection,addDoc,doc,getDoc,getDocs,updateDoc,query,where,orderBy}from\"firebase/firestore\";import{db}from\"./config\";const THREADS_COL=\"threads\";export async function getAllThreads(){const q=query(collection(db,THREADS_COL),orderBy(\"updatedAt\",\"desc\"));const snap=await getDocs(q);return snap.docs.map(d=>_objectSpread({id:d.id},d.data()));}export async function getUserThreads(userId){const q=query(collection(db,THREADS_COL),where(\"participants\",\"array-contains\",userId),orderBy(\"updatedAt\",\"desc\"));const snap=await getDocs(q);return snap.docs.map(d=>_objectSpread({id:d.id},d.data()));}export async function getThread(threadId){const ref=doc(db,THREADS_COL,threadId);const snap=await getDoc(ref);return snap.exists()?_objectSpread({id:snap.id},snap.data()):null;}export async function createThread(participants,initialMessage){const now=new Date();const threadRef=await addDoc(collection(db,THREADS_COL),{participants,createdAt:now,updatedAt:now,lastMessage:initialMessage.text||\"\"});await addDoc(collection(threadRef,\"messages\"),_objectSpread(_objectSpread({},initialMessage),{},{createdAt:now}));return threadRef.id;}export async function sendMessage(threadId,message){const threadRef=doc(db,THREADS_COL,threadId);const now=new Date();await addDoc(collection(threadRef,\"messages\"),_objectSpread(_objectSpread({},message),{},{createdAt:now}));await updateDoc(threadRef,{updatedAt:now,lastMessage:message.text||\"\"});}export async function getThreadMessages(threadId){const q=query(collection(db,\"\".concat(THREADS_COL,\"/\").concat(threadId,\"/messages\")),orderBy(\"createdAt\",\"asc\"));const snap=await getDocs(q);return snap.docs.map(d=>_objectSpread({id:d.id},d.data()));}","map":{"version":3,"names":["collection","addDoc","doc","getDoc","getDocs","updateDoc","query","where","orderBy","db","THREADS_COL","getAllThreads","q","snap","docs","map","d","_objectSpread","id","data","getUserThreads","userId","getThread","threadId","ref","exists","createThread","participants","initialMessage","now","Date","threadRef","createdAt","updatedAt","lastMessage","text","sendMessage","message","getThreadMessages","concat"],"sources":["C:/Users/Floyd/Desktop/Websites/HIAWTO/hi-awto-clean/src/firebase/messages.js"],"sourcesContent":["import {\r\n  collection,\r\n  addDoc,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  updateDoc,\r\n  query,\r\n  where,\r\n  orderBy,\r\n} from \"firebase/firestore\";\r\nimport { db } from \"./config\";\r\n\r\nconst THREADS_COL = \"threads\";\r\nexport async function getAllThreads() {\r\n  const q = query(\r\n    collection(db, THREADS_COL),\r\n    orderBy(\"updatedAt\", \"desc\")\r\n  );\r\n\r\n  const snap = await getDocs(q);\r\n\r\n  return snap.docs.map((d) => ({\r\n    id: d.id,\r\n    ...d.data(),\r\n  }));\r\n}\r\n\r\nexport async function getUserThreads(userId) {\r\n  const q = query(\r\n    collection(db, THREADS_COL),\r\n    where(\"participants\", \"array-contains\", userId),\r\n    orderBy(\"updatedAt\", \"desc\")\r\n  );\r\n  const snap = await getDocs(q);\r\n  return snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n}\r\n\r\nexport async function getThread(threadId) {\r\n  const ref = doc(db, THREADS_COL, threadId);\r\n  const snap = await getDoc(ref);\r\n  return snap.exists() ? { id: snap.id, ...snap.data() } : null;\r\n}\r\n\r\nexport async function createThread(participants, initialMessage) {\r\n  const now = new Date();\r\n  const threadRef = await addDoc(collection(db, THREADS_COL), {\r\n    participants,\r\n    createdAt: now,\r\n    updatedAt: now,\r\n    lastMessage: initialMessage.text || \"\",\r\n  });\r\n\r\n  await addDoc(collection(threadRef, \"messages\"), {\r\n    ...initialMessage,\r\n    createdAt: now,\r\n  });\r\n\r\n  return threadRef.id;\r\n}\r\n\r\nexport async function sendMessage(threadId, message) {\r\n  const threadRef = doc(db, THREADS_COL, threadId);\r\n  const now = new Date();\r\n\r\n  await addDoc(collection(threadRef, \"messages\"), {\r\n    ...message,\r\n    createdAt: now,\r\n  });\r\n\r\n  await updateDoc(threadRef, {\r\n    updatedAt: now,\r\n    lastMessage: message.text || \"\",\r\n  });\r\n}\r\n\r\nexport async function getThreadMessages(threadId) {\r\n  const q = query(\r\n    collection(db, `${THREADS_COL}/${threadId}/messages`),\r\n    orderBy(\"createdAt\", \"asc\")\r\n  );\r\n  const snap = await getDocs(q);\r\n  return snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}