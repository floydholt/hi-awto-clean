{"ast":null,"code":"// src/firebase/messages.js\nimport { collection, addDoc, doc, getDoc, getDocs, updateDoc, query, where, orderBy } from \"firebase/firestore\";\nimport { db } from \"./config\";\nconst THREADS_COL = \"threads\";\n\n// Get all threads (for admin)\nexport async function getAllThreads() {\n  const q = query(collection(db, THREADS_COL), orderBy(\"updatedAt\", \"desc\"));\n  const snap = await getDocs(q);\n  return snap.docs.map(d => ({\n    id: d.id,\n    ...d.data()\n  }));\n}\n\n// Get threads where user is a participant\nexport async function getUserThreads(userId) {\n  const q = query(collection(db, THREADS_COL), where(\"participants\", \"array-contains\", userId), orderBy(\"updatedAt\", \"desc\"));\n  const snap = await getDocs(q);\n  return snap.docs.map(d => ({\n    id: d.id,\n    ...d.data()\n  }));\n}\n\n// Get a single thread\nexport async function getThread(threadId) {\n  const ref = doc(db, THREADS_COL, threadId);\n  const snap = await getDoc(ref);\n  return snap.exists() ? {\n    id: snap.id,\n    ...snap.data()\n  } : null;\n}\n\n// Create a new thread with an initial message\nexport async function createThread(participants, initialMessage) {\n  const now = new Date();\n  const threadRef = await addDoc(collection(db, THREADS_COL), {\n    participants,\n    // [userId1, userId2, ...]\n    createdAt: now,\n    updatedAt: now,\n    lastMessage: initialMessage.text || \"\",\n    typing: {} // map of { userId: true/false }\n  });\n  await addDoc(collection(threadRef, \"messages\"), {\n    ...initialMessage,\n    createdAt: now\n  });\n  return threadRef.id;\n}\n\n// Send a message in an existing thread\nexport async function sendMessage(threadId, message) {\n  const threadRef = doc(db, THREADS_COL, threadId);\n  const now = new Date();\n  await addDoc(collection(threadRef, \"messages\"), {\n    ...message,\n    createdAt: now\n  });\n  await updateDoc(threadRef, {\n    updatedAt: now,\n    lastMessage: message.text || \"\"\n  });\n}\n\n// Get all messages for a thread\nexport async function getThreadMessages(threadId) {\n  const q = query(collection(db, `${THREADS_COL}/${threadId}/messages`), orderBy(\"createdAt\", \"asc\"));\n  const snap = await getDocs(q);\n  return snap.docs.map(d => ({\n    id: d.id,\n    ...d.data()\n  }));\n}\n\n// ðŸ”µ NEW: Set typing state for a user in a thread\nexport async function setThreadTyping(threadId, userId, isTyping) {\n  if (!threadId || !userId) return;\n  const threadRef = doc(db, THREADS_COL, threadId);\n  // Use a map field: typing.<userId> = true/false\n  await updateDoc(threadRef, {\n    [`typing.${userId}`]: isTyping\n  });\n}","map":{"version":3,"names":["collection","addDoc","doc","getDoc","getDocs","updateDoc","query","where","orderBy","db","THREADS_COL","getAllThreads","q","snap","docs","map","d","id","data","getUserThreads","userId","getThread","threadId","ref","exists","createThread","participants","initialMessage","now","Date","threadRef","createdAt","updatedAt","lastMessage","text","typing","sendMessage","message","getThreadMessages","setThreadTyping","isTyping"],"sources":["C:/Users/Floyd/Desktop/Websites/HIAWTO/hi-awto-clean/src/firebase/messages.js"],"sourcesContent":["// src/firebase/messages.js\r\nimport {\r\n  collection,\r\n  addDoc,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  updateDoc,\r\n  query,\r\n  where,\r\n  orderBy,\r\n} from \"firebase/firestore\";\r\nimport { db } from \"./config\";\r\n\r\nconst THREADS_COL = \"threads\";\r\n\r\n// Get all threads (for admin)\r\nexport async function getAllThreads() {\r\n  const q = query(\r\n    collection(db, THREADS_COL),\r\n    orderBy(\"updatedAt\", \"desc\")\r\n  );\r\n  const snap = await getDocs(q);\r\n  return snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n}\r\n\r\n// Get threads where user is a participant\r\nexport async function getUserThreads(userId) {\r\n  const q = query(\r\n    collection(db, THREADS_COL),\r\n    where(\"participants\", \"array-contains\", userId),\r\n    orderBy(\"updatedAt\", \"desc\")\r\n  );\r\n  const snap = await getDocs(q);\r\n  return snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n}\r\n\r\n// Get a single thread\r\nexport async function getThread(threadId) {\r\n  const ref = doc(db, THREADS_COL, threadId);\r\n  const snap = await getDoc(ref);\r\n  return snap.exists() ? { id: snap.id, ...snap.data() } : null;\r\n}\r\n\r\n// Create a new thread with an initial message\r\nexport async function createThread(participants, initialMessage) {\r\n  const now = new Date();\r\n\r\n  const threadRef = await addDoc(collection(db, THREADS_COL), {\r\n    participants,              // [userId1, userId2, ...]\r\n    createdAt: now,\r\n    updatedAt: now,\r\n    lastMessage: initialMessage.text || \"\",\r\n    typing: {},                // map of { userId: true/false }\r\n  });\r\n\r\n  await addDoc(collection(threadRef, \"messages\"), {\r\n    ...initialMessage,\r\n    createdAt: now,\r\n  });\r\n\r\n  return threadRef.id;\r\n}\r\n\r\n// Send a message in an existing thread\r\nexport async function sendMessage(threadId, message) {\r\n  const threadRef = doc(db, THREADS_COL, threadId);\r\n  const now = new Date();\r\n\r\n  await addDoc(collection(threadRef, \"messages\"), {\r\n    ...message,\r\n    createdAt: now,\r\n  });\r\n\r\n  await updateDoc(threadRef, {\r\n    updatedAt: now,\r\n    lastMessage: message.text || \"\",\r\n  });\r\n}\r\n\r\n// Get all messages for a thread\r\nexport async function getThreadMessages(threadId) {\r\n  const q = query(\r\n    collection(db, `${THREADS_COL}/${threadId}/messages`),\r\n    orderBy(\"createdAt\", \"asc\")\r\n  );\r\n  const snap = await getDocs(q);\r\n  return snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n}\r\n\r\n// ðŸ”µ NEW: Set typing state for a user in a thread\r\nexport async function setThreadTyping(threadId, userId, isTyping) {\r\n  if (!threadId || !userId) return;\r\n\r\n  const threadRef = doc(db, THREADS_COL, threadId);\r\n  // Use a map field: typing.<userId> = true/false\r\n  await updateDoc(threadRef, {\r\n    [`typing.${userId}`]: isTyping,\r\n  });\r\n}\r\n"],"mappings":"AAAA;AACA,SACEA,UAAU,EACVC,MAAM,EACNC,GAAG,EACHC,MAAM,EACNC,OAAO,EACPC,SAAS,EACTC,KAAK,EACLC,KAAK,EACLC,OAAO,QACF,oBAAoB;AAC3B,SAASC,EAAE,QAAQ,UAAU;AAE7B,MAAMC,WAAW,GAAG,SAAS;;AAE7B;AACA,OAAO,eAAeC,aAAaA,CAAA,EAAG;EACpC,MAAMC,CAAC,GAAGN,KAAK,CACbN,UAAU,CAACS,EAAE,EAAEC,WAAW,CAAC,EAC3BF,OAAO,CAAC,WAAW,EAAE,MAAM,CAC7B,CAAC;EACD,MAAMK,IAAI,GAAG,MAAMT,OAAO,CAACQ,CAAC,CAAC;EAC7B,OAAOC,IAAI,CAACC,IAAI,CAACC,GAAG,CAAEC,CAAC,KAAM;IAAEC,EAAE,EAAED,CAAC,CAACC,EAAE;IAAE,GAAGD,CAAC,CAACE,IAAI,CAAC;EAAE,CAAC,CAAC,CAAC;AAC1D;;AAEA;AACA,OAAO,eAAeC,cAAcA,CAACC,MAAM,EAAE;EAC3C,MAAMR,CAAC,GAAGN,KAAK,CACbN,UAAU,CAACS,EAAE,EAAEC,WAAW,CAAC,EAC3BH,KAAK,CAAC,cAAc,EAAE,gBAAgB,EAAEa,MAAM,CAAC,EAC/CZ,OAAO,CAAC,WAAW,EAAE,MAAM,CAC7B,CAAC;EACD,MAAMK,IAAI,GAAG,MAAMT,OAAO,CAACQ,CAAC,CAAC;EAC7B,OAAOC,IAAI,CAACC,IAAI,CAACC,GAAG,CAAEC,CAAC,KAAM;IAAEC,EAAE,EAAED,CAAC,CAACC,EAAE;IAAE,GAAGD,CAAC,CAACE,IAAI,CAAC;EAAE,CAAC,CAAC,CAAC;AAC1D;;AAEA;AACA,OAAO,eAAeG,SAASA,CAACC,QAAQ,EAAE;EACxC,MAAMC,GAAG,GAAGrB,GAAG,CAACO,EAAE,EAAEC,WAAW,EAAEY,QAAQ,CAAC;EAC1C,MAAMT,IAAI,GAAG,MAAMV,MAAM,CAACoB,GAAG,CAAC;EAC9B,OAAOV,IAAI,CAACW,MAAM,CAAC,CAAC,GAAG;IAAEP,EAAE,EAAEJ,IAAI,CAACI,EAAE;IAAE,GAAGJ,IAAI,CAACK,IAAI,CAAC;EAAE,CAAC,GAAG,IAAI;AAC/D;;AAEA;AACA,OAAO,eAAeO,YAAYA,CAACC,YAAY,EAAEC,cAAc,EAAE;EAC/D,MAAMC,GAAG,GAAG,IAAIC,IAAI,CAAC,CAAC;EAEtB,MAAMC,SAAS,GAAG,MAAM7B,MAAM,CAACD,UAAU,CAACS,EAAE,EAAEC,WAAW,CAAC,EAAE;IAC1DgB,YAAY;IAAe;IAC3BK,SAAS,EAAEH,GAAG;IACdI,SAAS,EAAEJ,GAAG;IACdK,WAAW,EAAEN,cAAc,CAACO,IAAI,IAAI,EAAE;IACtCC,MAAM,EAAE,CAAC,CAAC,CAAiB;EAC7B,CAAC,CAAC;EAEF,MAAMlC,MAAM,CAACD,UAAU,CAAC8B,SAAS,EAAE,UAAU,CAAC,EAAE;IAC9C,GAAGH,cAAc;IACjBI,SAAS,EAAEH;EACb,CAAC,CAAC;EAEF,OAAOE,SAAS,CAACb,EAAE;AACrB;;AAEA;AACA,OAAO,eAAemB,WAAWA,CAACd,QAAQ,EAAEe,OAAO,EAAE;EACnD,MAAMP,SAAS,GAAG5B,GAAG,CAACO,EAAE,EAAEC,WAAW,EAAEY,QAAQ,CAAC;EAChD,MAAMM,GAAG,GAAG,IAAIC,IAAI,CAAC,CAAC;EAEtB,MAAM5B,MAAM,CAACD,UAAU,CAAC8B,SAAS,EAAE,UAAU,CAAC,EAAE;IAC9C,GAAGO,OAAO;IACVN,SAAS,EAAEH;EACb,CAAC,CAAC;EAEF,MAAMvB,SAAS,CAACyB,SAAS,EAAE;IACzBE,SAAS,EAAEJ,GAAG;IACdK,WAAW,EAAEI,OAAO,CAACH,IAAI,IAAI;EAC/B,CAAC,CAAC;AACJ;;AAEA;AACA,OAAO,eAAeI,iBAAiBA,CAAChB,QAAQ,EAAE;EAChD,MAAMV,CAAC,GAAGN,KAAK,CACbN,UAAU,CAACS,EAAE,EAAE,GAAGC,WAAW,IAAIY,QAAQ,WAAW,CAAC,EACrDd,OAAO,CAAC,WAAW,EAAE,KAAK,CAC5B,CAAC;EACD,MAAMK,IAAI,GAAG,MAAMT,OAAO,CAACQ,CAAC,CAAC;EAC7B,OAAOC,IAAI,CAACC,IAAI,CAACC,GAAG,CAAEC,CAAC,KAAM;IAAEC,EAAE,EAAED,CAAC,CAACC,EAAE;IAAE,GAAGD,CAAC,CAACE,IAAI,CAAC;EAAE,CAAC,CAAC,CAAC;AAC1D;;AAEA;AACA,OAAO,eAAeqB,eAAeA,CAACjB,QAAQ,EAAEF,MAAM,EAAEoB,QAAQ,EAAE;EAChE,IAAI,CAAClB,QAAQ,IAAI,CAACF,MAAM,EAAE;EAE1B,MAAMU,SAAS,GAAG5B,GAAG,CAACO,EAAE,EAAEC,WAAW,EAAEY,QAAQ,CAAC;EAChD;EACA,MAAMjB,SAAS,CAACyB,SAAS,EAAE;IACzB,CAAC,UAAUV,MAAM,EAAE,GAAGoB;EACxB,CAAC,CAAC;AACJ","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}