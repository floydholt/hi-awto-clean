{"ast":null,"code":"import { collection, addDoc, doc, getDoc, getDocs, updateDoc, query, where, orderBy } from \"firebase/firestore\";\nimport { db } from \"./config\";\nconst THREADS_COL = \"threads\";\nexport async function getUserThreads(userId) {\n  const q = query(collection(db, THREADS_COL), where(\"participants\", \"array-contains\", userId), orderBy(\"updatedAt\", \"desc\"));\n  const snap = await getDocs(q);\n  return snap.docs.map(d => ({\n    id: d.id,\n    ...d.data()\n  }));\n}\nexport async function getThread(threadId) {\n  const ref = doc(db, THREADS_COL, threadId);\n  const snap = await getDoc(ref);\n  return snap.exists() ? {\n    id: snap.id,\n    ...snap.data()\n  } : null;\n}\nexport async function createThread(participants, initialMessage) {\n  const now = new Date();\n  const threadRef = await addDoc(collection(db, THREADS_COL), {\n    participants,\n    createdAt: now,\n    updatedAt: now,\n    lastMessage: initialMessage.text || \"\"\n  });\n  await addDoc(collection(threadRef, \"messages\"), {\n    ...initialMessage,\n    createdAt: now\n  });\n  return threadRef.id;\n}\nexport async function sendMessage(threadId, message) {\n  const threadRef = doc(db, THREADS_COL, threadId);\n  const now = new Date();\n  await addDoc(collection(threadRef, \"messages\"), {\n    ...message,\n    createdAt: now\n  });\n  await updateDoc(threadRef, {\n    updatedAt: now,\n    lastMessage: message.text || \"\"\n  });\n}\nexport async function getThreadMessages(threadId) {\n  const q = query(collection(db, `${THREADS_COL}/${threadId}/messages`), orderBy(\"createdAt\", \"asc\"));\n  const snap = await getDocs(q);\n  return snap.docs.map(d => ({\n    id: d.id,\n    ...d.data()\n  }));\n}","map":{"version":3,"names":["collection","addDoc","doc","getDoc","getDocs","updateDoc","query","where","orderBy","db","THREADS_COL","getUserThreads","userId","q","snap","docs","map","d","id","data","getThread","threadId","ref","exists","createThread","participants","initialMessage","now","Date","threadRef","createdAt","updatedAt","lastMessage","text","sendMessage","message","getThreadMessages"],"sources":["C:/Users/Floyd/Desktop/Websites/HIAWTO/hi-awto-clean/src/firebase/messages.js"],"sourcesContent":["import {\r\n  collection,\r\n  addDoc,\r\n  doc,\r\n  getDoc,\r\n  getDocs,\r\n  updateDoc,\r\n  query,\r\n  where,\r\n  orderBy,\r\n} from \"firebase/firestore\";\r\nimport { db } from \"./config\";\r\n\r\nconst THREADS_COL = \"threads\";\r\n\r\nexport async function getUserThreads(userId) {\r\n  const q = query(\r\n    collection(db, THREADS_COL),\r\n    where(\"participants\", \"array-contains\", userId),\r\n    orderBy(\"updatedAt\", \"desc\")\r\n  );\r\n  const snap = await getDocs(q);\r\n  return snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n}\r\n\r\nexport async function getThread(threadId) {\r\n  const ref = doc(db, THREADS_COL, threadId);\r\n  const snap = await getDoc(ref);\r\n  return snap.exists() ? { id: snap.id, ...snap.data() } : null;\r\n}\r\n\r\nexport async function createThread(participants, initialMessage) {\r\n  const now = new Date();\r\n  const threadRef = await addDoc(collection(db, THREADS_COL), {\r\n    participants,\r\n    createdAt: now,\r\n    updatedAt: now,\r\n    lastMessage: initialMessage.text || \"\",\r\n  });\r\n\r\n  await addDoc(collection(threadRef, \"messages\"), {\r\n    ...initialMessage,\r\n    createdAt: now,\r\n  });\r\n\r\n  return threadRef.id;\r\n}\r\n\r\nexport async function sendMessage(threadId, message) {\r\n  const threadRef = doc(db, THREADS_COL, threadId);\r\n  const now = new Date();\r\n\r\n  await addDoc(collection(threadRef, \"messages\"), {\r\n    ...message,\r\n    createdAt: now,\r\n  });\r\n\r\n  await updateDoc(threadRef, {\r\n    updatedAt: now,\r\n    lastMessage: message.text || \"\",\r\n  });\r\n}\r\n\r\nexport async function getThreadMessages(threadId) {\r\n  const q = query(\r\n    collection(db, `${THREADS_COL}/${threadId}/messages`),\r\n    orderBy(\"createdAt\", \"asc\")\r\n  );\r\n  const snap = await getDocs(q);\r\n  return snap.docs.map((d) => ({ id: d.id, ...d.data() }));\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}